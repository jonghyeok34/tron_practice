const TronWeb = require('../dist/TronWeb.node.js'); // require('tronweb');
const HttpProvider = TronWeb.providers.HttpProvider;

const fullNode = new HttpProvider('http://localhost:8090');
const solidityNode = new HttpProvider('http://localhost:8091');
const eventServer = 'https://api.shasta.trongrid.io';
const privateKey = 'bd74406eecc2915d2b69e95c9f322b354519ff57e587498f5b06d3d413596588';  //sr账户的私钥；
//因为交易谁发起都可以，但是必须要转钱出来的那个账户的私钥；

const app = async () => {
    const tronWeb = new TronWeb(
        fullNode,
        solidityNode,
        eventServer,
        privateKey
    );

    tronWeb.setDefaultBlock('latest');

    const nodes = await tronWeb.isConnected();
    const connected = !Object.entries(nodes).map(([name, connected]) => {
        if (!connected)
            console.error(`Error: ${name} is not connected`);

        return connected;
    }).includes(false);

    if (!connected)
        return;

    // Generated account
    // - Private Key: F8A6D31C0AD91C5AB99730FF35C8422A0151B89DB3342A6C7797435EC43A2DD8
    // - Public Key:  043A4477F299003B918FC0DA289C97EBA99C4EF2AAD1712A4F47FFBC3AD98837B907FC142243499D0B0249609456BB9FDD42B51E8ACB8C9445B45E53768C401440
    // Address
    // - Base58: TJnCTJf6CVvB8KyHoJ4c8PQETmP6jjydos
    // - Hex:    4160A419765B4A08273658652A68944F372251A4B4
    // - Valid:  true

    //执行一个交易；
    const transaction = await tronWeb.transactionBuilder.applyForSR('41B1AD0FF04063B45C05F8A6B05F26D78C7EB06D5B', 'http://test1112.com');
    const signedTransaction = await tronWeb.trx.sign(transaction, '7762dbe1c0705a1cc24923fc5c25d27d102dd1974ecc4f6c8ea4b3c671491d77', null, true)
    const result = await tronWeb.trx.broadcast(signedTransaction)
    console.log(result)

    //从SR转钱到我的账户
    // tronWeb.trx.sendTransaction('TSAfvb9eDeR32PfBY2vxZCePv6iD4KfUKA', 200000000000000, (err, result) => {
    //     if(err)
    //         return console.error(err);
    //     console.group('Send TRX transaction');
    //     console.log('- Result:\n' + JSON.stringify(result, null, 2), '\n');
    //     console.groupEnd();
    // });

    //创建新的账户；
    // const account = await tronWeb.createAccount();
    // const isValid = tronWeb.isAddress(account.address.hex);    
    // console.group('\nGenerated account');
    // console.log('- Private Key:', account.privateKey.toLowerCase());
    // console.log('- Public Key: ', account.publicKey.toLowerCase());
    // console.group('Address')
    // console.log('- Base58:', account.address.base58);
    // console.log('- Hex:   ', account.address.hex);
    // console.log('- Valid: ', isValid, '\n')
    // console.groupEnd();
    // console.groupEnd();

  
};

app();
